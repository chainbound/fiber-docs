<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Identifying hotspots on the Ethereum p2p network | Fiber Network</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fiber.chainbound.io/blog/ethereum-hotspots"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Identifying hotspots on the Ethereum p2p network | Fiber Network"><meta data-rh="true" name="description" content="In our journey of creating the ideal network topology for our Fiber nodes, we had to determine the critical geographical"><meta data-rh="true" property="og:description" content="In our journey of creating the ideal network topology for our Fiber nodes, we had to determine the critical geographical"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-10-21T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/jonasbostoen"><meta data-rh="true" property="article:tag" content="ethereum,devp2p"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://fiber.chainbound.io/blog/ethereum-hotspots"><link data-rh="true" rel="alternate" href="https://fiber.chainbound.io/blog/ethereum-hotspots" hreflang="en"><link data-rh="true" rel="alternate" href="https://fiber.chainbound.io/blog/ethereum-hotspots" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Fiber Network RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Fiber Network Atom Feed"><link rel="stylesheet" href="/assets/css/styles.d5a21055.css">
<link rel="preload" href="/assets/js/runtime~main.7fc0cb94.js" as="script">
<link rel="preload" href="/assets/js/main.41ef0149.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-full.svg" alt="Fiber Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-full.svg" alt="Fiber Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/pricing">Pricing</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/ethereum-hotspots">Identifying hotspots on the Ethereum p2p network</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Identifying hotspots on the Ethereum p2p network</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-10-21T00:00:00.000Z" itemprop="datePublished">October 21, 2022</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/jonasbostoen" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/jonasbostoen.png" alt="Jonas Bostoen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/jonasbostoen" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jonas Bostoen</span></a></div><small class="avatar__subtitle" itemprop="description">Chainbound CTO</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>In our journey of creating the ideal network topology for our Fiber nodes, we had to determine the critical geographical
regions of the Ethereum p2p network. We will define these &quot;hotspots&quot; as regions where the most transactions are originally
broadcasted from.</p><p>Because Fiber is a mempool service, we need to be able to deliver transactions to users as fast as possible, which also means making sure we sufficiently cover these hotspots. In essence, we want to make sure we&#x27;re as close to the original
broadcaster is possible, which in p2p terms means either being directly connected to it, or only 1 or 2 hops away. Each hop
will introduce a non-trivial amount of latency, which is something we need to minimize.</p><p>Let&#x27;s look at a couple scenarios:</p><p><img loading="lazy" src="/assets/images/2-hop-setup-472f68397ff0365f93fa9e97bd880999.png" width="2088" height="1126" class="img_ev3q"></p><p>In this setup, we&#x27;re 2 hops away from the transaction broadcaster. We&#x27;ll simplify here and assume that nodes always
broadcast the full transaction message, which is not the case <a href="#references">[2]</a>.</p><p>There are 3 factors introducing latency here:</p><ul><li><strong>A</strong>: The first network hop.</li><li><strong>B</strong>: The time it takes this node to process, validate, and re-broadcast the transaction.</li><li><strong>C</strong>: The second network hop.</li></ul><p>This network topology is not ideal, since your total latency will be <strong>A + B + C</strong>, and all of these steps
have an element of variability to them.</p><p>What we actually want is the following, single hop topology:</p><p><img loading="lazy" src="/assets/images/1-hop-setup-0c9cde82c28ea0ab946c5bc8f4ba5fcc.png" width="2088" height="1126" class="img_ev3q"></p><p>Here, the only latency we have is <strong>A</strong>, the first and only network hop. The only way to achieve this is to try
to <strong>connect to as much peers as possible in that region</strong>, which will give you a better chance of direct peerings
with transaction broadcasters. You can do this by either having one node with a very large maximum peer count, or by having more
than one node in the region. Because maintaining a large amount of peers is pretty resource intensive, we opted
for the second option.</p><p>Now that we know why we need to cover these hotspots sufficiently, how do we identify them?
This article will go over our findings.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-setup">The setup<a class="hash-link" href="#the-setup" title="Direct link to heading">​</a></h2><p>The setup will consist of a number of Ethereum nodes deployed globally that <strong>keep track of when they received a certain transaction, but also from which peer it came</strong>.
Later on, we&#x27;ll be able to inspect these timestamps to see which node heard about the transaction first.
We&#x27;ll also be able to use the peer IP addresses to find which hosting providers are responsible for broadcasting
the most transactions. But where do we deploy these nodes?</p><p>It&#x27;s no secret that <strong>most critical Ethereum infrastructure runs on AWS</strong> <a href="#references">[1]</a>:</p><p><img loading="lazy" src="/assets/images/hosting-chart-2b4315f334068219e0601b474a7a7620.png" width="1350" height="762" class="img_ev3q"></p><p>Which is why we deployed our nodes in the following 13 AWS regions:</p><ul><li>us-east-1 (N. Virginia)</li><li>us-east-2 (Ohio)</li><li>us-west-1 (N. California)</li><li>us-west-2 (Oregon)</li><li>ap-east-1 (Hong Kong)</li><li>ap-northeast-2 (Seoul)</li><li>ap-northeast-1 (Tokyo)</li><li>ap-southeast-1 (Singapore)</li><li>eu-west-1 (Ireland)</li><li>eu-west-2 (London)</li><li>eu-west-3 (Paris)</li><li>eu-north-1 (Stockholm) </li></ul><p>This obviously doesn&#x27;t cover the whole world, but since they&#x27;re located at backbone hotspots, it will do.</p><p>Each node will be connected to a significant amount of peers (400), <strong>for a theoretical
maximum reach of 5200 peers</strong>. In practice, this number will be a lot lower due to duplicate peers.
With this setup, we&#x27;ve recorded <strong>5.5 million Ethereum transactions</strong> over the period of a couple of days. Let&#x27;s look at the results.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-results">The results<a class="hash-link" href="#the-results" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="geography">Geography<a class="hash-link" href="#geography" title="Direct link to heading">​</a></h3><p><img loading="lazy" src="/assets/images/tx_geo-60d74af1388cc368069987071c6ece2f.png" width="1400" height="1000" class="img_ev3q">
Most transactions are seen first in the US in the North Virginia area, which is
where the notorious <strong>us-east-1</strong> AWS region sits. Ohio is a hotspot as well, seeing
a little more than 8% of transactions first. Regions on the West Coast are less active:
Oregon and North California combined only see a little more than 5% of transactions first.</p><p>In <strong>Europe</strong>, Frankfurt is by far the most active region. Paris and London are also important
regions, both seeing close to 6% of recorded transactions first. In the <strong>Asia Pacific</strong> region, Tokyo and Singapore are the most active.</p><p>Interestingly, looking at the activity per &quot;continent&quot;, we can see that the EU and the US lead by a wide margin:
<img loading="lazy" src="/assets/images/tx_geo_continent-f11cd786698220243e35b2a6201101a5.png" width="1400" height="1000" class="img_ev3q"></p><p>Based on these results, we&#x27;ve been able to work out a good geographical distribution of our node setup.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hosting-providers">Hosting providers<a class="hash-link" href="#hosting-providers" title="Direct link to heading">​</a></h3><p>Since we recorded the sending peer of every transaction, we can take a closer look at the different hosting
providers that originate the most transactions. We know that AWS hosts a lot of full nodes, but is that actually where
infrastructure that belongs to the largest <em>transaction broadcasters</em> is?</p><p>To figure that out, we&#x27;ll look at the top 3 most &quot;active&quot; peers (peers from which we received the most transactions first) per region, and identify the hosting provider based on their IP addresses.</p><p><strong>us-east-1: Virginia region</strong></p><p>All in AWS, Virginia.</p><p><strong>eu-central-1: Frankfurt region</strong></p><p>All in Hetzner, Frankfurt. Hetzner is a bare metal cloud provider that&#x27;s primarily active in Germany.</p><p><strong>us-east-2: Ohio region</strong></p><p>All in AWS, Virginia. Only the 4th biggest originated from the AWS Ohio datacenter, again confirming that the us-east-1 region
is a big hotspot.</p><p><strong>eu-west-3: Paris region</strong></p><ol><li>Google Cloud, Brussels</li><li>Google Cloud, Brussels</li><li>Hetzner, Frankfurt</li></ol><p>This seems to suggest that the Paris region itself is not very active.</p><p><strong>eu-west-2: London region</strong></p><ol><li>OVHCloud, London</li><li>Google Cloud, Brussels</li><li>Hetzner, Frankfurt</li></ol><p><strong>ap-northeast-1: Tokyo region</strong></p><ol><li>AWS, Tokyo</li><li>AWS, Virginia</li><li>AWS, Tokyo</li></ol><p><strong>ap-southeast-1: Singapore region</strong></p><ol><li>Contabo, Singapore</li><li>Hetzner, Frankfurt (?)</li><li>AWS, Singapore</li></ol><p><strong>eu-west-1: Dublin region</strong></p><ol><li>AWS, Dublin</li><li>AWS, Tokyo (?)</li><li>AWS, Dublin</li></ol><p><strong>us-west-2: Oregon region</strong></p><ol><li>Telus Communications, Vancouver</li><li>AWS, Virginia</li><li>AWS, Oregon</li></ol><p><strong>ap-east-1: Hong Kong region</strong></p><ol><li>Google Cloud, Hong Kong</li><li>Google Cloud, Hong Kong</li><li>AWS, Virginia (?)</li></ol><p><strong>ap-northeast-2: Seoul region</strong></p><ol><li>AWS, Seoul</li><li>AWS, Seoul</li><li>AWS, Tokyo</li></ol><p><strong>eu-north-1: Stockholm region</strong></p><ol><li>Hetzner, Frankfurt</li><li>AWS, Virginia (?)</li><li>Hetzner, Finland</li></ol><p><strong>us-west-1: California region</strong></p><ol><li>AWS, Virginia</li><li>AWS, Virginia</li><li>AWS, California</li></ol><p>And putting all the winners in a table:</p><table><thead><tr><th>Region</th><th>Hosting Provider</th></tr></thead><tbody><tr><td>us-east-1</td><td>AWS, Virginia</td></tr><tr><td>eu-central-1</td><td>Hetzner, Frankfurt</td></tr><tr><td>us-east-2</td><td>AWS, Ohio</td></tr><tr><td>eu-west-3</td><td>Google Cloud, Brussels</td></tr><tr><td>eu-west-2</td><td>OVH, UK</td></tr><tr><td>ap-northeast-1</td><td>AWS, Tokyo</td></tr><tr><td>ap-southeast-1</td><td>Contabo, Singapore</td></tr><tr><td>eu-west-1</td><td>AWS, Dublin</td></tr><tr><td>us-west-2</td><td>Telus Communications, Vancouver</td></tr><tr><td>ap-east-1</td><td>Google Cloud, Hong Kong</td></tr><tr><td>ap-northeast-2</td><td>AWS, Seoul</td></tr><tr><td>eu-north-1</td><td>Hetzner, Frankfurt</td></tr><tr><td>us-west-1</td><td>AWS, Virginia</td></tr></tbody></table><p>Turns out that <strong>AWS wins only in 6 of the 13 regions</strong>. In Virginia and in Ohio, both very important regions, it has been the biggest broadcaster. But we also see Google Cloud winning in Hong Kong as well as in Paris (from their datacenter in Brussels, Belgium). Hetzner wins in Frankfurt by a wide margin, perhaps not surprisingly. It also wins in Stockholm, Sweden,
even though the broadcaster was in Frankfurt. This tells us that the eu-north area does not seem to have a lot of
activity. Overall, Hetzner is a really active hosting provider in Europe.
In Oregon, the biggest broadcaster was in Vancouver, Canada. In Singapore, it came from Contabo.</p><p>Another interesting observation is that there&#x27;s almost never one broadcaster that stands out per region. The second and
third biggest broadcasters are never far behind. This suggests that providers like <a href="https://www.alchemy.com/" target="_blank" rel="noopener noreferrer">Alchemy</a>
and <a href="https://infura.io/" target="_blank" rel="noopener noreferrer">Infura</a>, who send the largest part of Ethereum transactions, use a lot of nodes, possibly
distributed across geographic areas.</p><p>You might have also noticed the slight anomalies tagged with <strong>(?)</strong>. These are entries that don&#x27;t really make a lot of sense.
The fact that an AWS broadcaster in Virginia can make the top 3 active peers of our node in Hong Kong
means that those transactions didn&#x27;t arrive at our node in Virginia first. For now, we attribute these anomalies to the randomness
of the p2p network, but we&#x27;ll continue looking into it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>When milliseconds matter, this is all information that has to be taken into consideration, and that&#x27;s what we did
with Fiber. Listening to transactions is only one aspect of high frequency trading on blockchains, but it&#x27;s a very important one that one needs to get right by carefully choosing the regions, concentration, and cloud providers
across which to deploy nodes.</p><p>If you&#x27;re interested in learning more about Fiber, check out the <a href="/docs/intro">documentation</a> or
join the <a href="https://discord.gg/J4KNdeCYGX" target="_blank" rel="noopener noreferrer">Discord</a>. We will be posting more stories like these,
follow us on Twitter for updates <a href="https://twitter.com/chainbound_" target="_blank" rel="noopener noreferrer">@chainbound_</a>!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ol><li><a href="https://ethernodes.org/networkType/Hosting" target="_blank" rel="noopener noreferrer">https://ethernodes.org/networkType/Hosting</a></li><li>In reality, the full message is only broadcast to a subset of peers, whereas the rest receive only the hash <strong>announcement</strong>.
It&#x27;s up to these nodes to check if they&#x27;ve already received the transaction, and otherwise they have to request
it. This introduces another round trip. See the devp2p specificiation on transaction exchange: <a href="https://github.com/ethereum/devp2p/blob/master/caps/eth.md#transaction-exchange" target="_blank" rel="noopener noreferrer">https://github.com/ethereum/devp2p/blob/master/caps/eth.md#transaction-exchange</a></li></ol></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/devp-2-p">devp2p</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2022-10-21-ethereum-hotspots/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-setup" class="table-of-contents__link toc-highlight">The setup</a></li><li><a href="#the-results" class="table-of-contents__link toc-highlight">The results</a><ul><li><a href="#geography" class="table-of-contents__link toc-highlight">Geography</a></li><li><a href="#hosting-providers" class="table-of-contents__link toc-highlight">Hosting providers</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/J4KNdeCYGX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/chainbound" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Chainbound, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7fc0cb94.js"></script>
<script src="/assets/js/main.41ef0149.js"></script>
</body>
</html>