"use strict";(self.webpackChunkfiber_website=self.webpackChunkfiber_website||[]).push([[953],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),d=r,g=c["".concat(l,".").concat(d)]||c[d]||h[d]||o;return n?a.createElement(g,i(i({ref:t},u),{},{components:n})):a.createElement(g,i({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5851:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const o={slug:"transaction-geography",title:"Tracing the geographic origin of Ethereum transactions",authors:["jonas"]},i=void 0,s={permalink:"/blog/transaction-geography",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2022-10-21-tx-geo/index.md",source:"@site/blog/2022-10-21-tx-geo/index.md",title:"Tracing the geographic origin of Ethereum transactions",description:"In our journey of creating the ideal network topology for our Fiber nodes, we had to determine the critical geographical",date:"2022-10-21T00:00:00.000Z",formattedDate:"October 21, 2022",tags:[],readingTime:4.17,hasTruncateMarker:!1,authors:[{name:"Jonas Bostoen",title:"Chainbound CTO",url:"https://github.com/jonasbostoen",imageURL:"https://github.com/jonasbostoen.png",key:"jonas"}],frontMatter:{slug:"transaction-geography",title:"Tracing the geographic origin of Ethereum transactions",authors:["jonas"]}},l={authorsImageUrls:[void 0]},p=[{value:"The setup",id:"the-setup",level:2},{value:"The results",id:"the-results",level:2},{value:"Geography",id:"geography",level:4},{value:"Hosting providers",id:"hosting-providers",level:4},{value:"Conclusion",id:"conclusion",level:2},{value:"References",id:"references",level:2}],u={toc:p};function h(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,'In our journey of creating the ideal network topology for our Fiber nodes, we had to determine the critical geographical\nregions of the Ethereum p2p network. We will define these "hot spots" as regions where the most transactions are originally\nbroadcasted from.'),(0,r.kt)("p",null,"Because Fiber is a mempool service, we need to be able to deliver transactions to users as fast as possible, which also means making sure we sufficiently cover these hotspots. This article will go over our findings."),(0,r.kt)("h2",{id:"the-setup"},"The setup"),(0,r.kt)("p",null,"The setup will be a number of Ethereum nodes deployed globally that ",(0,r.kt)("strong",{parentName:"p"},"keep track of when they received a certain transaction, but also\nfrom which peer it came"),".\nLater on, we'll be able to inspect these timestamps to see which node heard about the transaction first.\nWe'll also be able to use the peer IP addresses to find which hosting providers are responsible for broadcasting\nthe most transactions."),(0,r.kt)("p",null,"Each node will be connected to a significant amount of peers (400), ",(0,r.kt)("strong",{parentName:"p"},"for a theoretical\nmaximum reach of 6000 peers"),". In practice, this number will be a lot lower due to duplicate peers.\nNow where do we deploy these nodes?"),(0,r.kt)("p",null,"It's no secret that ",(0,r.kt)("strong",{parentName:"p"},"most critical Ethereum infrastructure runs on AWS")," ",(0,r.kt)("a",{parentName:"p",href:"#references"},"[1]"),":"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(2950).Z,width:"1350",height:"762"})),(0,r.kt)("p",null,"Which is why we deployed our nodes in the following 13 AWS regions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"us-east-1 (N. Virginia)"),(0,r.kt)("li",{parentName:"ul"},"us-east-2 (Ohio)"),(0,r.kt)("li",{parentName:"ul"},"us-west-1 (N. California)"),(0,r.kt)("li",{parentName:"ul"},"us-west-2 (Oregon)"),(0,r.kt)("li",{parentName:"ul"},"ap-east-1 (Hong Kong)"),(0,r.kt)("li",{parentName:"ul"},"ap-northeast-2 (Seoul)"),(0,r.kt)("li",{parentName:"ul"},"ap-northeast-1 (Tokyo)"),(0,r.kt)("li",{parentName:"ul"},"ap-southeast-1 (Singapore)"),(0,r.kt)("li",{parentName:"ul"},"eu-west-1 (Ireland)"),(0,r.kt)("li",{parentName:"ul"},"eu-west-2 (London)"),(0,r.kt)("li",{parentName:"ul"},"eu-west-3 (Paris)"),(0,r.kt)("li",{parentName:"ul"},"eu-north-1 (Stockholm) ")),(0,r.kt)("p",null,"This obviously doesn't cover the whole world, but since they're located at backbone hotspots, it will do."),(0,r.kt)("p",null,"With this setup, we've recorded 5.5 million Ethereum transactions over the period of a couple of days. Let's look at the results."),(0,r.kt)("h2",{id:"the-results"},"The results"),(0,r.kt)("h4",{id:"geography"},"Geography"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(7199).Z,width:"1400",height:"1000"}),"\nMost transactions are seen first in the US in the North Virginia area, which is\nwhere the notorious ",(0,r.kt)("strong",{parentName:"p"},"us-east-1")," AWS region sits. Ohio is a hotspot as well, seeing\na little more than 8% of transactions first. Regions on the West Coast are less active:\nOregon and North California combined only see a little more than 5% of transactions first."),(0,r.kt)("p",null,"In ",(0,r.kt)("strong",{parentName:"p"},"Europe"),", Frankfurt is by far the most active region. Paris and London are also important\nregions, both seeing close to 6% of recorded transactions first. In the ",(0,r.kt)("strong",{parentName:"p"},"Asia Pacific")," region, Tokyo and Singapore are the most active."),(0,r.kt)("p",null,'Interestingly, looking at the activity per "continent", we can see that the EU and the US lead by a wide margin:\n',(0,r.kt)("img",{src:n(6440).Z,width:"1400",height:"1000"})),(0,r.kt)("p",null,"Based on these results, we've determined the number of nodes to deploy in each of these regions."),(0,r.kt)("h4",{id:"hosting-providers"},"Hosting providers"),(0,r.kt)("p",null,"Since we recorded the sending peer of every transaction, we can take a closer look at the different hosting\nproviders that originate the most transactions. We know that AWS hosts a lot of full nodes, but is that actually where\ninfrastructure that belongs to the largest ",(0,r.kt)("em",{parentName:"p"},"transaction broadcasters")," is?"),(0,r.kt)("p",null,'To figure that out, we\'ll look at the most "active" peer (peer from which we received the most transactions first) per region, and identify the hosting provider based on their IP address.'),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Region"),(0,r.kt)("th",{parentName:"tr",align:null},"Hosting Provider"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"us-east-1"),(0,r.kt)("td",{parentName:"tr",align:null},"AWS, Virginia")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eu-central-1"),(0,r.kt)("td",{parentName:"tr",align:null},"Hetzner, Falkenstein")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"us-east-2"),(0,r.kt)("td",{parentName:"tr",align:null},"AWS, Ohio")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eu-west-3"),(0,r.kt)("td",{parentName:"tr",align:null},"Google Cloud, Brussels")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eu-west-2"),(0,r.kt)("td",{parentName:"tr",align:null},"OVH, UK")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ap-northeast-1"),(0,r.kt)("td",{parentName:"tr",align:null},"AWS, Tokyo")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ap-southeast-1"),(0,r.kt)("td",{parentName:"tr",align:null},"Contabo, Singapore")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eu-west-1"),(0,r.kt)("td",{parentName:"tr",align:null},"AWS, Dublin")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"us-west-2"),(0,r.kt)("td",{parentName:"tr",align:null},"Telus Communications, Vancouver")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ap-east-1"),(0,r.kt)("td",{parentName:"tr",align:null},"Google Cloud, Hong Kong")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ap-northeast-2"),(0,r.kt)("td",{parentName:"tr",align:null},"AWS, Seoul")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"eu-north-1"),(0,r.kt)("td",{parentName:"tr",align:null},"Hetzner, Falkenstein")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"us-west-1"),(0,r.kt)("td",{parentName:"tr",align:null},"AWS, Virginia")))),(0,r.kt)("p",null,"Turns out that ",(0,r.kt)("strong",{parentName:"p"},"AWS wins only in 6 of the 13 regions"),". In Virginia and in Ohio, both very important regions, it has been the biggest broadcaster. But we also see Google Cloud winning in Hong Kong as well as in Paris (from their datacenter in Brussels, Belgium). Hetzner wins in Frankfurt by a wide margin, perhaps not surprisingly. It also wins in Stockholm, Sweden,\neven though the broadcaster was in Frankfurt. This tells us that the eu-north area does not seem to have a lot of\nactivity. In Oregon, the biggest broadcaster was in Vancouver, Canada. In Singapore, it came from Contabo."),(0,r.kt)("p",null,"Another interesting observation is that there's almost never one broadcaster that stands out per region. The second and\nthird biggest broadcasters are never far behind. This suggests that providers like ",(0,r.kt)("a",{parentName:"p",href:"https://www.alchemy.com/"},"Alchemy"),"\nand ",(0,r.kt)("a",{parentName:"p",href:"https://infura.io/"},"Infura"),", who send the largest part of Ethereum transactions, use a lot of nodes, possibly\ndistributed across geographic areas."),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"When milliseconds matter, this is all information that has to be taken into consideration, and that's what we did\nwith Fiber. Listening to transactions is only one aspect of high frequency trading on blockchains, but it's a very important one that one needs to get right by carefully choosing the regions, concentration, and cloud providers\nacross which to deploy nodes."),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://ethernodes.org/networkType/Hosting"},"https://ethernodes.org/networkType/Hosting"))))}h.isMDXComponent=!0},2950:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/hosting-chart-2b4315f334068219e0601b474a7a7620.png"},7199:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/tx_geo-60d74af1388cc368069987071c6ece2f.png"},6440:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/tx_geo_continent-f11cd786698220243e35b2a6201101a5.png"}}]);