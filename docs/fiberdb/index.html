<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-fiberdb">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">FiberDB | Fiber Network</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fiber.chainbound.io/docs/fiberdb"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="FiberDB | Fiber Network"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/img/favicon2.svg"><link data-rh="true" rel="canonical" href="https://fiber.chainbound.io/docs/fiberdb"><link data-rh="true" rel="alternate" href="https://fiber.chainbound.io/docs/fiberdb" hreflang="en"><link data-rh="true" rel="alternate" href="https://fiber.chainbound.io/docs/fiberdb" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Fiber Network RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Fiber Network Atom Feed"><link rel="stylesheet" href="/assets/css/styles.aa87a547.css">
<link rel="preload" href="/assets/js/runtime~main.82b8141b.js" as="script">
<link rel="preload" href="/assets/js/main.2e6da5d5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon2.svg" alt="Fiber Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon2.svg" alt="Fiber Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/pricing">Pricing</a><a href="#" class="navbar__item navbar__link">Stats (Coming Soon)</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/use-cases">Use Cases</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/docs/usage/getting-started">Usage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/usage/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/usage/streams_sub">Subscribing to Streams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/usage/transaction_broad">Broadcasting Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/usage/tracing">Tracing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/usage/fiber-inject">Mempool Injector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/usage/fiber-guard">FiberGuard</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/regions">Regions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/fiberdb">FiberDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">FiberDB</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>FiberDB</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>FiberDB is a component that collects all message observations (transactions, blocks) from all of the deployed Fiber nodes. It then separates these observations into objects and stores them in designated tables in a Clickhouse database. Format below:</p><p><img loading="lazy" alt="Fiber-IndexDB-ERD.png" src="/assets/images/fiberdb-erd-0a3bb54a0ce8d73b9ed96d44f6770e92.png" width="2625" height="2380" class="img_ev3q"></p><p>The most interesting tables are the observations table. Since we have global points of presence in the form of Fiber Nodes, that connect to both the eth1 (execution) and eth2 (consensus) networks, we can link traffic on both p2p networks to geographic regions.</p><p>For the eth1 network, this allows us to identify the big transaction originators. This will be some of the biggest RPC node providers. Customers will be able to use this data to strategically place their clients. Since we also store application-level data (the full transaction), it’s possible to link app-specific data to the network layer. This would be useful in identifying PGAs for example.</p><p>For the eth2 network, we can locate validators, staking pools and relays. We can also analyze equivocations and other anomalies on the consensus network.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-format">Data Format<a class="hash-link" href="#data-format" title="Direct link to heading">​</a></h2><ul><li><strong><code>transaction_observations</code></strong></li></ul><p>All of the observations of a certain transaction (identified by <code>tx_hash</code>) through the Fiber network. More details below.</p><ul><li><strong><code>private_transaction_observations</code></strong></li></ul><p>Same as above but for private (user) transactions. Only accessible by the user that sent the transaction for tracing / debugging purposes.</p><ul><li><strong><code>transactions</code></strong></li></ul><p>All of the individual transaction along with their payloads. This is what you would see on Etherscan. The reason that we index these as well is that not all transactions sent over the network eventually end up on the chain, and some of them get lost / replaced. We want to know what types of these transactions are as well. One example use case of this would be identifying PGAs - a lot of the replaced transactions won’t end up on the chain, but since we index their payload, we can easily look into what was going on.</p><ul><li><strong><code>block_observations</code></strong></li></ul><p>All of the observations of a certain block (identified by <code>block_hash</code> and <code>block_number</code>) through the Fiber network. This allows us to see, at a network level, where blocks are originated and how they propagate. It will also allow us to trace potential equivocation attacks or slashable offenses more closely.</p><ul><li><strong><code>block_headers</code></strong></li></ul><p>Header payloads. Same as with the transactions table, allows us to examine blocks that didn’t make it on the canonical chain more closely.</p><ul><li><strong><code>block_bodies</code></strong></li></ul><p>Contain all of the transaction hashes in that block. Cross-checking these with the <code>transaction_observations</code> table will allow us to identify “private” transactions (i.e. not broadcasted over the p2p network).</p><p>Let’s take a closer look at the <code>transaction_observations</code> and <code>block_observations</code> tables. Each row in these tables is an observation from one of our nodes, along with some network metadata like <code>timestamp</code>, <code>region</code>, <code>node_id</code> and <code>source</code>. The <code>source</code> is the peer we received the message from.</p><p>The observations are further categorized by <code>observation_type</code>. This column describes where the message came from, and it can either be from a peer in the p2p network (<code>p2p</code>), or from another Fiber node (<code>fiber</code>). All transactions are propagated over the internal Fiber network for lower latency, which is why we have this column to distinguish the 2.</p><p>For any message observation (unless it’s the first), there will likely be a row with the <code>fiber</code> type first, and a <code>p2p</code> type second, because the Fiber network is usually faster than the p2p network. We record both types so that we can analyze the delta between them, as well as the normal p2p propagation behaviour.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="database">Database<a class="hash-link" href="#database" title="Direct link to heading">​</a></h2><p>This data is backed by a hosted <a href="https://clickhouse.com/" target="_blank" rel="noopener noreferrer">Clickhouse</a> database. We chose Clickhouse Cloud due to its impressive performance, automatic up/down scaling, and great UX. As a customer, there are 2 ways for you to get this data:</p><ol><li><strong>Realtime Push</strong>: our indexing middleware would connect directly to your database, and all messages will be pushed to the DB as soon as the indexer sees them. You would be able to define what data you want to save. This option is the most flexible, because you’ll be able to do whatever you want with the data once you have it locally.</li><li><strong>Hosted DB Access</strong>: you get access to our hosted Clickhouse DB. We create a user with limited quota’s, with which you can connect and do everything you need. Less flexible, but no need to store anything locally.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a class="hash-link" href="#example" title="Direct link to heading">​</a></h2><p>Let’s look at an example transaction trace:</p><p><img loading="lazy" alt="FiberDB Example Trace" src="/assets/images/fiberdb-example-a53c8d7d095f6ccf966914d426f11805.png" width="1297" height="706" class="img_ev3q"></p><ul><li>The transaction was first received by node <code>fiber-node-nzB22n0B-eu-central-1</code> in Frankfurt.</li><li>It then sent it on to the Fiber network to all of the other nodes, and the nodes in Europe got the transaction soon after. With a small delay, they also received it from the p2p network (check the <code>observation_type</code> column)</li><li>However, in the US, it was received by node <code>fiber-node-Bhg6kcGw-us-east-1</code> from the <code>p2p</code> network first. It then propagated it on to the other nodes in the US, and we see the same thing happening as in the previous step.</li><li>Then, in AP, node <code>fiber-node-jnv6bfld-ap-east-1</code> in Hong Kong picked up the transaction from a peer and broadcasts it on.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/fiberdb.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/regions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Regions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FAQ</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#data-format" class="table-of-contents__link toc-highlight">Data Format</a></li><li><a href="#database" class="table-of-contents__link toc-highlight">Database</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/J4KNdeCYGX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/chainbound" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Chainbound LLC</div></div></div></footer></div>
<script src="/assets/js/runtime~main.82b8141b.js"></script>
<script src="/assets/js/main.2e6da5d5.js"></script>
</body>
</html>